<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¯Ø§Ù…Ø§ Ø¨Ø±Ùˆ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©</title>
    <style>
        :root { 
            --wood: #3e2723;
            --dark-cell: #5d3a2a;
            --light-cell: #e0c091;
            --white-piece: radial-gradient(circle at 35% 35%, #ffffff, #dcdde1);
            --black-piece: radial-gradient(circle at 35% 35%, #444, #000);
            --gold: #f1c40f;
        }
        * { touch-action: none; -webkit-tap-highlight-color: transparent; user-select: none; box-sizing: border-box; }
        body { background: #121212; color: white; text-align: center; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; overflow: hidden; }
        
        .header { background: #1e1e1e; padding: 10px; border-bottom: 3px solid #333; height: 110px; z-index: 10; position: relative; }
        .score-board { display: flex; justify-content: space-around; font-weight: bold; margin-top: 8px; }
        .score-item { background: #2c2c2c; padding: 5px 15px; border-radius: 15px; border: 1px solid #444; }
        .score-val { color: var(--gold); font-size: 1.2rem; }

        .board-container { display: flex; justify-content: center; align-items: center; height: calc(100vh - 110px); padding: 10px; }
        .board { 
            display: grid; grid-template-columns: repeat(8, 1fr); 
            width: 95vw; height: 95vw; max-width: 440px; max-height: 440px; 
            border: 12px solid var(--wood); background: var(--wood);
            box-shadow: 0 15px 50px rgba(0,0,0,0.8); border-radius: 5px;
        }
        
        .cell { width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; cursor: pointer; }
        .dark { background: var(--dark-cell); }
        .light { background: var(--light-cell); }
        
        .piece { 
            width: 84%; height: 84%; border-radius: 50%; 
            position: relative; box-shadow: inset 0 -4px 6px rgba(0,0,0,0.4), 0 5px 10px rgba(0,0,0,0.5);
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .white { background: var(--white-piece); border: 1px solid #999; }
        .black { background: var(--black-piece); border: 1px solid #222; }
        .king::after { content: 'ğŸ‘‘'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.5rem; filter: drop-shadow(0 2px 2px #000); }
        
        .selected { transform: scale(1.15); border: 3px solid var(--gold) !important; z-index: 5; box-shadow: 0 0 20px var(--gold); }
        .can-move { background: rgba(241, 196, 15, 0.2) !important; }

        #overlay { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); z-index: 1000; justify-content: center; align-items: center; flex-direction: column; 
        }
        .win-msg { font-size: 2.5rem; color: var(--gold); margin-bottom: 20px; text-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .btn { padding: 15px 35px; border-radius: 30px; background: #c0392b; color: white; border: none; font-size: 1.2rem; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn:active { transform: scale(0.9); }
        .restart-top { padding: 5px 15px; font-size: 0.8rem; background: #444; margin-top: 5px; }
    </style>
</head>
<body>

    <audio id="moveSnd" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"></audio>
    <audio id="capSnd" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>

    <div class="header">
        <div id="status">Ø¯Ø§Ù…Ø§ Ø¨Ø±Ùˆ - Ø¯ÙˆØ±Ùƒ</div>
        <div class="score-board">
            <div class="score-item">Ø£Ù†Øª: <span id="p-score" class="score-val">0</span></div>
            <div class="score-item">Ø§Ù„Ø¨ÙˆØª: <span id="b-score" class="score-val">0</span></div>
        </div>
        <button class="btn restart-top" onclick="resetGame()">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„ÙˆØ­Ø©</button>
    </div>

    <div class="board-container">
        <div class="board" id="board"></div>
    </div>

    <div id="overlay">
        <h2 class="win-msg" id="winner-text">Ù…Ø¨Ø±ÙˆÙƒ Ø§Ù„ÙÙˆØ²!</h2>
        <button class="btn" onclick="resetGame()">Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
    </div>

    <script>
        const boardEl = document.getElementById('board');
        const statusEl = document.getElementById('status');
        const pScoreEl = document.getElementById('p-score');
        const bScoreEl = document.getElementById('b-score');
        const moveSnd = document.getElementById('moveSnd');
        const capSnd = document.getElementById('capSnd');

        let board = Array(64).fill(null);
        let turn = 'player';
        let selected = null;
        let isMultiJump = false;

        let pScore = parseInt(localStorage.getItem('pScore')) || 0;
        let bScore = parseInt(localStorage.getItem('bScore')) || 0;
        pScoreEl.innerText = pScore; bScoreEl.innerText = bScore;

        function init() {
            board = Array(64).fill(null);
            for (let i = 0; i < 64; i++) {
                let r = Math.floor(i/8), c = i%8;
                if ((r + c) % 2 !== 0) {
                    if (r < 3) board[i] = { color: 'bot', king: false };
                    else if (r > 5) board[i] = { color: 'player', king: false };
                }
            }
            turn = 'player'; selected = null; isMultiJump = false;
            statusEl.innerText = "Ø¯ÙˆØ±Ùƒ Ø§Ù„Ø¢Ù† (Ø§Ù„Ø£Ø¨ÙŠØ¶)";
            render();
            checkGameOver();
        }

        function render() {
            boardEl.innerHTML = '';
            board.forEach((p, i) => {
                const cell = document.createElement('div');
                cell.className = `cell ${(Math.floor(i / 8) + i % 8) % 2 !== 0 ? 'dark' : 'light'}`;
                if (p) {
                    const div = document.createElement('div');
                    div.className = `piece ${p.color === 'player' ? 'white' : 'black'} ${p.king ? 'king' : ''}`;
                    if (selected === i) div.classList.add('selected');
                    cell.appendChild(div);
                }
                cell.onclick = () => handleClick(i);
                boardEl.appendChild(cell);
            });
        }

        function handleClick(i) {
            if (turn !== 'player') return;
            if (board[i] && board[i].color === 'player' && !isMultiJump) {
                selected = i;
            } else if (selected !== null) {
                let move = validate(selected, i, 'player');
                if (move) {
                    execute(move);
                    if (move.m && checkAvailableJumps(i, 'player').length > 0) {
                        isMultiJump = true; selected = i;
                        statusEl.innerText = "Ø£ÙƒÙ„ Ù…ØªÙˆØ§Ù„ÙŠ! Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¶Ø±Ø¨...";
                    } else {
                        isMultiJump = false; turn = 'bot';
                        statusEl.innerText = "ØªÙÙƒÙŠØ± Ø§Ù„Ø¨ÙˆØª...";
                        setTimeout(botMove, 800);
                    }
                }
            }
            render();
        }

        function validate(f, t, color) {
            if (board[t] || t < 0 || t > 63) return null;
            let p = board[f], r1 = Math.floor(f / 8), c1 = f % 8, r2 = Math.floor(t / 8), c2 = t % 8;
            let dr = r2 - r1, dc = c2 - c1;

            if (Math.abs(dr) !== Math.abs(dc)) return null;

            if (!p.king) {
                if (!isMultiJump && Math.abs(dc) === 1 && dr === (color === 'player' ? -1 : 1)) return { f, t };
                if (Math.abs(dc) === 2) {
                    let mid = (f + t) / 2;
                    if (board[mid] && board[mid].color !== color) return { f, t, m: mid };
                }
            } else {
                let stepR = dr / Math.abs(dr), stepC = dc / Math.abs(dc), mid = null, count = 0;
                for (let s = 1; s < Math.abs(dr); s++) {
                    let idx = (r1 + s * stepR) * 8 + (c1 + s * stepC);
                    if (board[idx]) { if (board[idx].color !== color) { count++; mid = idx; } else return null; }
                }
                if (count === 0 && !isMultiJump) return { f, t };
                if (count === 1) return { f, t, m: mid };
            }
            return null;
        }

        function execute(m) {
            board[m.t] = board[m.f]; board[m.f] = null;
            if (m.m) { board[m.m] = null; capSnd.play().catch(()=>{}); } 
            else { moveSnd.play().catch(()=>{}); }
            
            if (Math.floor(m.t / 8) === 0 && board[m.t].color === 'player') board[m.t].king = true;
            if (Math.floor(m.t / 8) === 7 && board[m.t].color === 'bot') board[m.t].king = true;
            selected = null; render();
        }

        function botMove() {
            let moves = getAllMoves('bot');
            if (moves.length === 0) { endGame('player'); return; }

            let jumps = moves.filter(m => m.m);
            let final = jumps.length ? jumps[Math.floor(Math.random() * jumps.length)] : moves[Math.floor(Math.random() * moves.length)];
            
            execute(final);
            if (final.m && checkAvailableJumps(final.t, 'bot').length > 0) {
                setTimeout(botMove, 500);
            } else {
                turn = 'player'; statusEl.innerText = "Ø¯ÙˆØ±Ùƒ Ø§Ù„Ø¢Ù†";
                if (getAllMoves('player').length === 0) endGame('bot');
            }
            render();
        }

        function getAllMoves(color) {
            let all = [];
            board.forEach((p, i) => {
                if (p && p.color === color) {
                    for (let t = 0; t < 64; t++) {
                        let m = validate(i, t, color);
                        if (m) all.push(m);
                    }
                }
            });
            return all;
        }

        function checkAvailableJumps(f, color) {
            let jumps = [];
            for (let t = 0; t < 64; t++) {
                let m = validate(f, t, color);
                if (m && m.m) jumps.push(m);
            }
            return jumps;
        }

        function checkGameOver() {
            if (getAllMoves('player').length === 0) { endGame('bot'); return true; }
            if (getAllMoves('bot').length === 0) { endGame('player'); return true; }
            return false;
        }

        function endGame(winner) {
            if (winner === 'player') { pScore++; localStorage.setItem('pScore', pScore); document.getElementById('winner-text').innerText = "Ù…Ø¨Ø±ÙˆÙƒ Ø§Ù„ÙÙˆØ²!"; }
            else { bScore++; localStorage.setItem('bScore', bScore); document.getElementById('winner-text').innerText = "Ù„Ù„Ø£Ø³Ù! ÙØ§Ø² Ø§Ù„Ø¨ÙˆØª"; }
            pScoreEl.innerText = pScore; bScoreEl.innerText = bScore;
            document.getElementById('overlay').style.display = 'flex';
        }

        function resetGame() {
            document.getElementById('overlay').style.display = 'none';
            init();
        }

        init();
    </script>
</body>
</html>
