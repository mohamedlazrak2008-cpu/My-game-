<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù„Ø¯Ø§Ù…Ø§ Ø§Ù„Ù…ØºØ±Ø¨ÙŠØ© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>
    <style>
        :root { --wood:#3e2723; --dark:#5d3a2a; --light:#e0c091; --gold:#f1c40f; }
        *{box-sizing:border-box;user-select:none;-webkit-tap-highlight-color:transparent}
        body{margin:0;background:#121212;color:#fff;font-family:sans-serif;
        display:flex;flex-direction:column;height:100vh;text-align:center; overflow: hidden;}

        .header{background:#1e1e1e;padding:10px;border-bottom:3px solid #333; flex-shrink: 0;}
        .score-board{display:flex;justify-content:space-around;margin-top:5px}
        .score-item{background:#2c2c2c;padding:6px 14px;border-radius:12px;border:1px solid #444}
        .score-val{color:var(--gold);font-weight:bold}

        .board-container{flex:1;display:flex;justify-content:center;align-items:center;padding:10px; touch-action: pinch-zoom;}
        .board{
            display:grid;grid-template-columns:repeat(8,1fr);
            width:95vw;height:95vw;max-width:460px;max-height:460px;
            border:10px solid var(--wood);background:var(--wood);
            box-shadow:0 15px 50px rgba(0,0,0,.9); border-radius: 8px;
            touch-action: none;
        }

        .cell{display:flex;align-items:center;justify-content:center}
        .dark{background:var(--dark)}
        .light{background:var(--light)}

        .piece{
            width:84%;height:84%;border-radius:50%;
            box-shadow:inset 0 -4px 6px rgba(0,0,0,.4),0 5px 10px rgba(0,0,0,.5);
            transition:.18s;position:relative; z-index: 2;
        }
        .white{background:radial-gradient(circle at 35% 35%,#fff,#ccc); border: 1px solid #999;}
        .black{background:radial-gradient(circle at 35% 35%,#444,#000); border: 1px solid #222;}

        .king::after{
            content:"ğŸ‘‘";position:absolute;top:50%;left:50%;
            transform:translate(-50%,-50%);font-size:1.4rem; filter: drop-shadow(0 2px 2px #000);
        }

        .selected{transform:scale(1.15); border: 3px solid var(--gold) !important; box-shadow: 0 0 15px var(--gold);}
        .must-capture{ animation: pulse 1s infinite; border: 2px solid #e74c3c !important; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); } 100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); } }

        #overlay{
            display:none;position:fixed;inset:0;background:rgba(0,0,0,.95);
            z-index:1000;flex-direction:column;justify-content:center;align-items:center
        }
        .btn{
            padding:15px 35px;border-radius:30px;background:#c0392b;
            border:none;color:white;font-weight:bold;font-size:1.2rem; cursor: pointer;
        }
    </style>
</head>
<body>

    <audio id="moveSnd" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"></audio>
    <audio id="capSnd" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>

    <div class="header">
        <div id="status">Ø§Ù„Ø¯Ø§Ù…Ø§ Ø§Ù„Ù…ØºØ±Ø¨ÙŠØ© â€” Ø¯ÙˆØ±Ùƒ</div>
        <div class="score-board">
            <div class="score-item">Ø£Ù†Øª <span id="pScore" class="score-val">0</span></div>
            <div class="score-item">Ø§Ù„Ø¨ÙˆØª <span id="bScore" class="score-val">0</span></div>
        </div>
    </div>

    <div class="board-container">
        <div id="board" class="board"></div>
    </div>

    <div id="overlay">
        <h2 id="winnerText" style="color:var(--gold); font-size: 2rem; margin-bottom: 20px;"></h2>
        <button class="btn" onclick="resetGame()">Ù„Ø¹Ø¨ Ù…Ù† Ø¬Ø¯ÙŠØ¯</button>
    </div>

<script>
    const boardEl = document.getElementById("board");
    const statusEl = document.getElementById("status");
    const pScoreEl = document.getElementById("pScore");
    const bScoreEl = document.getElementById("bScore");
    const moveSnd = document.getElementById("moveSnd");
    const capSnd = document.getElementById("capSnd");

    let board, turn, selected, mandatory, multiJump, lock;
    let pScore = parseInt(localStorage.getItem('pScore')) || 0;
    let bScore = parseInt(localStorage.getItem('bScore')) || 0;
    pScoreEl.textContent = pScore; bScoreEl.textContent = bScore;

    const inside = i => i>=0 && i<64;
    const rc = i => [Math.floor(i/8), i%8];
    const idx = (r,c)=> r*8+c;
    const dark = i => ((Math.floor(i/8)+i%8)%2===1);

    function newPiece(color){ return {color, king:false}; }

    function initBoard(){
        board = Array(64).fill(null);
        for(let i=0;i<64;i++){
            if(!dark(i)) continue;
            let r=Math.floor(i/8);
            if(r<3) board[i]=newPiece("bot");
            if(r>4) board[i]=newPiece("player");
        }
    }

    function start(){
        initBoard();
        turn="player"; selected=null; mandatory=[]; multiJump=false; lock=false;
        findMandatory();
        statusEl.textContent = "Ø§Ù„Ø¯Ø§Ù…Ø§ Ø§Ù„Ù…ØºØ±Ø¨ÙŠØ© â€” Ø¯ÙˆØ±Ùƒ";
        render();
    }

    function render(){
        boardEl.innerHTML="";
        for(let i=0;i<64;i++){
            let cell=document.createElement("div");
            cell.className="cell "+(dark(i)?"dark":"light");
            if(board[i]){
                let p=document.createElement("div");
                p.className="piece "+(board[i].color==="player"?"white":"black");
                if(board[i].king) p.classList.add("king");
                if(selected===i) p.classList.add("selected");
                if(turn==="player" && mandatory.some(m=>m.from===i))
                    p.classList.add("must-capture");
                cell.appendChild(p);
            }
            cell.onclick=()=>onClick(i);
            boardEl.appendChild(cell);
        }
    }

    function dirs(piece){
        if(piece.king) return [[1,1],[1,-1],[-1,1],[-1,-1]];
        return piece.color==="player" ? [[-1,1],[-1,-1]] : [[1,1],[1,-1]];
    }

    function validate(from,to,color){
        if(!inside(from)||!inside(to)||board[to]) return null;
        if(!dark(to)) return null;
        let p=board[from];
        if(!p || p.color!==color) return null;
        let [r1,c1]=rc(from);
        let [r2,c2]=rc(to);
        let dr=r2-r1, dc=c2-c1;
        if(Math.abs(dr)!==Math.abs(dc)) return null;
        let stepR=Math.sign(dr), stepC=Math.sign(dc);
        let dist=Math.abs(dr);

        if(!p.king){
            if(dist===1 && !multiJump && (color==="player"?dr===-1:dr===1)) return {from,to};
            if(dist===2){
                let mid=idx(r1+stepR,c1+stepC);
                if(board[mid] && board[mid].color!==color) return {from,to,cap:mid};
            }
            return null;
        }

        let enemy=null, count=0;
        for(let s=1;s<dist;s++){
            let i=idx(r1+s*stepR,c1+s*stepC);
            if(board[i]){
                if(board[i].color===color) return null;
                enemy=i; count++;
            }
        }
        if(count===0 && !multiJump) return {from,to};
        if(count===1) return {from,to,cap:enemy};
        return null;
    }

    function allMoves(color){
        let moves=[];
        for(let i=0;i<64;i++){
            if(board[i] && board[i].color===color){
                for(let t=0;t<64;t++){
                    let m=validate(i,t,color);
                    if(m) moves.push(m);
                }
            }
        }
        return moves;
    }

    function findMandatory(){
        mandatory = allMoves(turn).filter(m=>m.cap!==undefined);
    }

    function execMove(m){
        board[m.to]=board[m.from];
        board[m.from]=null;
        if(m.cap!==undefined) {
            board[m.cap]=null;
            capSnd.play().catch(()=>{});
        } else {
            moveSnd.play().catch(()=>{});
        }
        let [r2]=rc(m.to);
        if(board[m.to].color==="player" && r2===0) board[m.to].king=true;
        if(board[m.to].color==="bot" && r2===7) board[m.to].king=true;
        selected=null;
    }

    function onClick(i){
        if(lock || turn!=="player") return;
        if(board[i] && board[i].color==="player"){
            if(multiJump && selected!==i) return;
            if(mandatory.length && !mandatory.some(m=>m.from===i)) return;
            selected=i; render(); return;
        }
        if(selected===null) return;
        let m=validate(selected,i,"player");
        if(mandatory.length && (!m || m.cap===undefined)) return;
        if(!m) return;
        execMove(m);
        if(m.cap!==undefined && allMoves("player").filter(x=>x.from===m.to && x.cap!==undefined).length > 0){
            multiJump=true; selected=m.to; findMandatory(); statusEl.textContent="ÙƒÙ…Ù‘Ù„ Ø§Ù„Ø£ÙƒÙ„!"; render(); return;
        }
        multiJump=false; turn="bot"; lock=true; render(); setTimeout(botTurn,600);
    }

    function botTurn(){
        findMandatory();
        let moves = mandatory.length ? mandatory : allMoves("bot");
        if(!moves.length){ endGame("ØªØ¨Ø§Ø±Ùƒ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙƒØŒ Ø±Ø¨Ø­ØªÙŠ!"); return; }
        let m = moves[Math.floor(Math.random()*moves.length)];
        execMove(m);
        if(m.cap!==undefined && allMoves("bot").filter(x=>x.from===m.to && x.cap!==undefined).length > 0){
            setTimeout(botTurn,400); return;
        }
        turn="player"; lock=false; findMandatory(); statusEl.textContent="Ø¯ÙˆØ±Ùƒ"; render(); checkEnd();
    }

    function checkEnd(){
        if(!allMoves("player").length) endGame("Ø§Ù„Ø¨ÙˆØª Ø±Ø¨Ø­");
        if(!allMoves("bot").length) endGame("Ø£Ù†Øª Ø±Ø¨Ø­Øª");
    }

    function endGame(msg){
        document.getElementById("winnerText").textContent=msg;
        document.getElementById("overlay").style.display="flex";
        if(msg.includes("Ø±Ø¨Ø­Øª")) { pScore++; localStorage.setItem('pScore', pScore); } 
        else { bScore++; localStorage.setItem('bScore', bScore); }
        pScoreEl.textContent=pScore; bScoreEl.textContent=bScore;
    }

    function resetGame(){
        document.getElementById("overlay").style.display="none";
        start();
    }

    start();
</script>
</body>
</html>
