<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¯Ø§Ù…Ø§ Ø¨Ø±Ùˆ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ØµÙ„Ø­Ø©</title>
    <style>
        :root { 
            --wood: #3e2723;
            --dark-cell: #5d3a2a;
            --light-cell: #e0c091;
            --white-piece: radial-gradient(circle at 35% 35%, #ffffff, #dcdde1);
            --black-piece: radial-gradient(circle at 35% 35%, #444, #000);
            --gold: #f1c40f;
        }
        * { touch-action: none; -webkit-tap-highlight-color: transparent; user-select: none; box-sizing: border-box; }
        body { background: #121212; color: white; text-align: center; font-family: sans-serif; margin: 0; overflow: hidden; display: flex; flex-direction: column; height: 100vh; }
        
        .header { background: #1e1e1e; padding: 15px; border-bottom: 3px solid #333; }
        .score-board { display: flex; justify-content: space-around; font-weight: bold; margin-top: 10px; }
        .score-item { background: #2c2c2c; padding: 5px 15px; border-radius: 15px; border: 1px solid #444; }
        .score-val { color: var(--gold); font-size: 1.2rem; margin: 0 5px; }

        .board-container { flex: 1; display: flex; justify-content: center; align-items: center; padding: 10px; }
        .board { 
            display: grid; grid-template-columns: repeat(8, 1fr); 
            width: 95vw; height: 95vw; max-width: 450px; max-height: 450px; 
            border: 8px solid var(--wood); background: var(--wood);
            box-shadow: 0 10px 40px rgba(0,0,0,0.8); border-radius: 4px;
        }
        
        .cell { width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; position: relative; }
        .dark { background: var(--dark-cell); }
        .light { background: var(--light-cell); }
        
        .piece { 
            width: 85%; height: 85%; border-radius: 50%; 
            position: relative; box-shadow: inset 0 -4px 6px rgba(0,0,0,0.4), 0 5px 10px rgba(0,0,0,0.5);
            transition: all 0.2s; z-index: 2;
        }
        .white { background: var(--white-piece); border: 1px solid #999; }
        .black { background: var(--black-piece); border: 1px solid #222; }
        .king::after { content: 'ğŸ‘‘'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.4rem; filter: drop-shadow(0 2px 2px #000); }
        
        .selected { transform: scale(1.1); border: 3px solid var(--gold) !important; box-shadow: 0 0 15px var(--gold); z-index: 10; }

        #overlay { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); z-index: 1000; justify-content: center; align-items: center; flex-direction: column; 
        }
        .btn { padding: 12px 30px; border-radius: 25px; background: #c0392b; color: white; border: none; font-size: 1.1rem; cursor: pointer; font-weight: bold; margin-top: 20px; }
    </style>
</head>
<body>

    <div class="header">
        <div id="status">Ø¯Ø§Ù…Ø§ Ø¨Ø±Ùˆ - Ø¯ÙˆØ±Ùƒ</div>
        <div class="score-board">
            <div class="score-item">Ø£Ù†Øª:<span id="p-score" class="score-val">0</span></div>
            <div class="score-item">Ø§Ù„Ø¨ÙˆØª:<span id="b-score" class="score-val">0</span></div>
        </div>
    </div>

    <div class="board-container">
        <div class="board" id="board"></div>
    </div>

    <div id="overlay">
        <h2 id="winner-text">Ù…Ø¨Ø±ÙˆÙƒ Ø§Ù„ÙÙˆØ²!</h2>
        <button class="btn" onclick="resetGame()">Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
    </div>

    <script>
        const boardEl = document.getElementById('board');
        const statusEl = document.getElementById('status');
        const pScoreEl = document.getElementById('p-score');
        const bScoreEl = document.getElementById('b-score');

        let board = Array(64).fill(null);
        let turn = 'player';
        let selected = null;
        let pScore = parseInt(localStorage.getItem('pScore')) || 0;
        let bScore = parseInt(localStorage.getItem('bScore')) || 0;

        pScoreEl.innerText = pScore; bScoreEl.innerText = bScore;

        function init() {
            board = Array(64).fill(null);
            for (let i = 0; i < 64; i++) {
                let r = Math.floor(i/8), c = i%8;
                if ((r + c) % 2 !== 0) {
                    if (r < 3) board[i] = { color: 'bot', king: false };
                    else if (r > 4) board[i] = { color: 'player', king: false };
                }
            }
            render();
        }

        function render() {
            boardEl.innerHTML = '';
            board.forEach((p, i) => {
                const cell = document.createElement('div');
                cell.className = `cell ${(Math.floor(i/8)+i%8)%2!==0 ? 'dark':'light'}`;
                if (p) {
                    const div = document.createElement('div');
                    div.className = `piece ${p.color==='player'?'white':'black'} ${p.king?'king':''}`;
                    if (selected === i) div.classList.add('selected');
                    cell.appendChild(div);
                }
                cell.onclick = () => handleClick(i);
                boardEl.appendChild(cell);
            });
        }

        function handleClick(i) {
            if (turn !== 'player') return;
            if (board[i] && board[i].color === 'player') {
                selected = i;
            } else if (selected !== null) {
                let move = validate(selected, i, 'player');
                if (move) {
                    execute(move);
                    turn = 'bot';
                    statusEl.innerText = "Ø§Ù„Ø¨ÙˆØª ÙŠÙÙƒØ±...";
                    setTimeout(botMove, 700);
                }
            }
            render();
        }

        function validate(f, t, color) {
            if (board[t]) return null;
            let p = board[f], r1 = Math.floor(f/8), c1 = f%8, r2 = Math.floor(t/8), c2 = t%8;
            let dr = r2 - r1, dc = Math.abs(c2 - c1);
            if (Math.abs(dr) !== dc) return null;

            if (!p.king) {
                if (dc === 1 && dr === (color==='player'?-1:1)) return {f, t};
                if (dc === 2) {
                    let m = (f + t) / 2;
                    if (board[m] && board[m].color !== color) return {f, t, m};
                }
            } else {
                let sR = dr/Math.abs(dr), sC = (c2-c1)/dc, m=null, count=0;
                for (let s=1; s<Math.abs(dr); s++) {
                    let idx = (r1+s*sR)*8 + (c1+s*sC);
                    if (board[idx]) { if (board[idx].color!==color) {count++; m=idx;} else return null; }
                }
                if (count <= 1) return {f, t, m};
            }
            return null;
        }

        function execute(m) {
            board[m.t] = board[m.f]; board[m.f] = null;
            if (m.m) board[m.m] = null;
            if (Math.floor(m.t/8) === 0 && board[m.t].color === 'player') board[m.t].king = true;
            if (Math.floor(m.t/8) === 7 && board[m.t].color === 'bot') board[m.t].king = true;
            selected = null; render(); checkWin();
        }

        function botMove() {
            let moves = [];
            board.forEach((p, i) => {
                if (p && p.color === 'bot') {
                    for (let t=0; t<64; t++) {
                        let m = validate(i, t, 'bot');
                        if (m) moves.push(m);
                    }
                }
            });
            if (moves.length) {
                let jumps = moves.filter(m => m.m);
                let final = jumps.length ? jumps[Math.floor(Math.random()*jumps.length)] : moves[Math.floor(Math.random()*moves.length)];
                execute(final);
            }
            turn = 'player'; statusEl.innerText = "Ø¯ÙˆØ±Ùƒ Ø§Ù„Ø¢Ù†"; render();
        }

        function checkWin() {
            let p = board.filter(x => x && x.color==='player').length;
            let b = board.filter(x => x && x.color==='bot').length;
            if (p === 0) endGame('bot');
            else if (b === 0) endGame('player');
        }

        function endGame(w) {
            if (w === 'player') { pScore++; localStorage.setItem('pScore', pScore); document.getElementById('winner-text').innerText="Ø¨Ø·Ù„! ÙØ²Øª"; }
            else { bScore++; localStorage.setItem('bScore', bScore); document.getElementById('winner-text').innerText="Ù‡Ø§Ø±Ø¯ Ù„Ùƒ! ÙØ§Ø² Ø§Ù„Ø¨ÙˆØª"; }
            pScoreEl.innerText = pScore; bScoreEl.innerText = bScore;
            document.getElementById('overlay').style.display = 'flex';
        }

        function resetGame() {
            document.getElementById('overlay').style.display = 'none';
            init();
        }

        init();
    </script>
</body>
</html>
